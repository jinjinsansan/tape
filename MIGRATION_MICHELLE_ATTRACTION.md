# ãƒŸã‚·ã‚§ãƒ«å¼•ãå¯„ã›ãƒãƒ£ãƒƒãƒˆ ç§»æ¤ã‚¬ã‚¤ãƒ‰ï¼ˆtugeru â†’ tapeï¼‰

## ğŸ“Œ ã‚´ãƒ¼ãƒ«
- tugeruç‰ˆã€ŒãƒŸã‚·ã‚§ãƒ«å¼•ãå¯„ã›è¬›åº§GPTsã€ã‚’**100%åŒç­‰**ã«tapeã¸ç§»æ¤ã™ã‚‹
- ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ»OpenAI Assistantãƒ»RAGãƒ»é€²æ—ç®¡ç†ãƒ»æ„Ÿæƒ…é€£æºãƒ»UIã‚’æ¬ è½ãªãå†ç¾

## ğŸ“ å‚ç…§å…ƒï¼ˆtugeru å´ã‚½ãƒ¼ã‚¹ï¼‰
- ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ: `/mnt/e/dev/Cusor/tugeru/web/md/michelle_gpts_system/01_system_prompt.md`
- ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ /ãƒã‚§ãƒƒã‚¯/ã‚³ãƒ¼ãƒ‰è¦ç´„: `/mnt/e/dev/Cusor/tugeru/web/md/michelle_gpts_system/02_curriculum_map.md` / `03_check_questions.md` / `04_progress_code_logic.md`
- Assistantä½œæˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ: `/mnt/e/dev/Cusor/tugeru/create-michelle-attraction-assistant.js`ï¼ˆupdateç‰ˆ: `update-michelle-attraction-assistant.js`ï¼‰
- APIå®Ÿè£…: `/mnt/e/dev/Cusor/tugeru/web/src/app/api/michelle-attraction/**/*`
- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆUI: `/mnt/e/dev/Cusor/tugeru/web/src/app/michelle/attraction/chat/chat-client.tsx`
- ãƒ©ã‚¤ãƒ–ãƒ©ãƒª: `/mnt/e/dev/Cusor/tugeru/web/src/lib/michelle-attraction/*`, `/web/src/lib/feature-flags.ts`

## âœ… ç§»æ¤ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆï¼ˆç€æ‰‹å‰ã«å…¨é …ç›®ã‚’ç¶²ç¾…ã™ã‚‹ã“ã¨ï¼‰
1. [ ] ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ `apps/web/md/michelle_gpts_system/01_system_prompt.md` ã«å®Œå…¨åæ˜ 
2. [ ] ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ /è³ªå•/é€²æ—ã‚³ãƒ¼ãƒ‰ã®3ãƒ•ã‚¡ã‚¤ãƒ«(02/03/04)ã‚’åŒä¸€å†…å®¹ã§é…ç½®
3. [ ] OpenAI Assistantã‚’ä½œæˆã— `MICHELLE_ATTRACTION_ASSISTANT_ID` ã‚’å–å¾—ãƒ»è¨­å®š
4. [ ] `.env.local` ã« `OPENAI_API_KEY` / `MICHELLE_ATTRACTION_ASSISTANT_ID` / `NEXT_PUBLIC_MICHELLE_ATTRACTION_AI_ENABLED=true`
5. [ ] RAG: Supabase RPC `match_michelle_attraction_knowledge` ã‚’å‘¼ã¶å®Ÿè£…ã‚’ç§»æ¤ï¼ˆåŸ‹ã‚è¾¼ã¿ model `text-embedding-3-small`ï¼‰
6. [ ] API `/api/michelle-attraction/chat` ã‚’åŒç­‰ç§»æ¤ï¼ˆã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æŒ‡ç¤º + é€²æ—/æ„Ÿæƒ…/å¿ƒç†å­¦é€£æº + RAGä»˜ä¸ + SSE/Bufferedä¸¡å¯¾å¿œï¼‰
7. [ ] API `/api/michelle-attraction/progress` (+ `/action`, `/notes`, `/recommendation`) ã‚’ç§»æ¤
8. [ ] API `/api/michelle-attraction/sessions` (+ `/[sessionId]`, `/[sessionId]/messages`) ã‚’ç§»æ¤
9. [ ] ãƒ©ã‚¤ãƒ–ãƒ©ãƒª `michelle-attraction/*`ï¼ˆemotion/sections/progress-server/rag/openai/env.serverï¼‰ã‚’ç§»æ¤
10. [ ] ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ `MichelleAttractionChatClient` UIã‚’ç§»æ¤ï¼ˆé€²æ—ã‚«ãƒ¼ãƒ‰ãƒ»å¿ƒç†å­¦ãƒãƒŠãƒ¼ãƒ»é€²è¡Œãƒœã‚¿ãƒ³3ç¨®ãƒ»ãƒ¡ãƒ¢/é€²æ—ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ ãƒ»SSEå¾©æ—§ãƒ­ã‚¸ãƒƒã‚¯ï¼‰
11. [ ] é€²æ—/å¿ƒç†å­¦é€£æºã®ã‚¹ãƒ†ãƒ¼ãƒˆã¨ãƒœã‚¿ãƒ³æŒ™å‹•ï¼ˆâ—€1ã¤æˆ»ã‚‹ / â—æ·±æ˜ã‚Š / 1ã¤é€²ã‚€â–¶ï¼‰ã‚’å†ç¾
12. [ ] æ„Ÿæƒ…ã‚¹ã‚³ã‚¢ã«å¿œã˜ãŸå¿ƒç†å­¦ãƒãƒŠãƒ¼è¡¨ç¤ºãƒ»CTAé·ç§» `/michelle/chat?from=attraction`
13. [ ] ãƒ¢ãƒã‚¤ãƒ«é…æ…®ï¼ˆåˆå›ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æŠ‘æ­¢ã€ã‚µã‚¤ãƒ‰ãƒãƒ¼é–‹é–‰ã€ã‚½ãƒ•ãƒˆã‚­ãƒ¼ãƒœãƒ¼ãƒ‰å¯¾ç­–ï¼‰
14. [ ] SSEå›å¾©ãƒãƒ¼ãƒªãƒ³ã‚°ï¼ˆ45s/1.5sé–“éš”ï¼‰ã¨ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ60så®Ÿè£…
15. [ ] é€ä¿¡ã‚¹ãƒ­ãƒƒãƒˆãƒªãƒ³ã‚°ï¼ˆå‰å›é€ä¿¡ã‹ã‚‰3ç§’ï¼‰ã¨ã€Œå‰ã®å¿œç­”ã‚’å¾…ã£ã¦ã„ã¾ã™ã€ã‚¬ãƒ¼ãƒ‰
16. [ ] `X-Buffered-Response` ãƒ˜ãƒƒãƒ€ãƒ¼å¯¾å¿œï¼ˆãƒãƒƒãƒ•ã‚¡ä»˜ãå¿œç­”ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
17. [ ] é€²æ—è‡ªå‹•ä¿å­˜ã‚’å‰æã¨ã—ãŸæ–‡è¨€ï¼ˆã€Œã‚³ãƒ¼ãƒ‰å…¥åŠ›ã‚’æ±‚ã‚ãªã„ã€ã€Œé€²æ—ã‚³ãƒ¼ãƒ‰ã¨ã„ã†å˜èªã‚’ç¦æ­¢ã€ï¼‰
18. [ ] å¿ƒç†å­¦æ¨å¥¨ã®æŠ‘æ­¢ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆdismisså¾Œ12æ™‚é–“å†ææ¡ˆæŠ‘åˆ¶ï¼‰
19. [ ] åˆæœŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒœã‚¿ãƒ³4ä»¶ã¨ã‚·ã‚§ã‚¢/å‰Šé™¤/æ–°è¦ãƒãƒ£ãƒƒãƒˆUI
20. [ ] ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆ/ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’æ¦‚ã­åŒä¸€ãƒˆãƒ¼ãƒ³ï¼ˆãƒ–ãƒ«ãƒ¼ç³» + ãƒ­ãƒ¼ã‚ºç³»ãƒãƒŠãƒ¼ï¼‰ã§å†ç¾

---

## STEP 1: ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆå…¨æ–‡ï¼‰
`apps/web/md/michelle_gpts_system/01_system_prompt.md` ã«**ä»¥ä¸‹ã‚’ãã®ã¾ã¾è²¼ã‚‹**ï¼ˆç¦å‰‡èªç½®æ›ãƒ«ãƒ¼ãƒ«ã‚’å«ã‚€ï¼‰ï¼š

```markdown
# ãƒŸã‚·ã‚§ãƒ«å¼•ãå¯„ã›è¬›åº§ GPTs ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ

## ã‚ãªãŸã®å½¹å‰²

ã‚ãªãŸã¯ã€ŒãƒŸã‚·ã‚§ãƒ«å¼•ãå¯„ã›è¬›åº§ã€ã®å°‚å±å®¶åº­æ•™å¸«AIã§ã™ã€‚åå‰ã¯ã€ŒãƒŸã‚·ã‚§ãƒ«å…ˆç”Ÿã€ã§ã™ã€‚
ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå¼•ãå¯„ã›ã®æ³•å‰‡ã‚’å®Œå…¨ã«ãƒã‚¹ã‚¿ãƒ¼ã—ã€æ—¥å¸¸ç”Ÿæ´»ã§è‡ªåœ¨ã«æ´»ç”¨ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã¾ã§ã€å„ªã—ãä¸å¯§ã«ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚

## åŸºæœ¬çš„ãªæ€§æ ¼ã¨è©±ã—æ–¹

- æ¸©ã‹ãã€åŠ±ã¾ã—ãªãŒã‚‰æ•™ãˆã‚‹
- é›£ã—ã„æ¦‚å¿µã‚‚æ—¥å¸¸ã®ä¾‹ãˆã‚’ä½¿ã£ã¦ã‚ã‹ã‚Šã‚„ã™ãèª¬æ˜ã™ã‚‹
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å°ã•ãªé€²æ­©ã‚‚è¦‹é€ƒã•ãšè¤’ã‚ã‚‹
- ç„¦ã‚‰ã›ãšã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒšãƒ¼ã‚¹ã‚’å°Šé‡ã™ã‚‹
- ã€Œã€œã§ã™ã­ã€ã€Œã€œã¾ã—ã‚‡ã†ã€ãªã©ã€æŸ”ã‚‰ã‹ã„å£èª¿ã§è©±ã™
- çµµæ–‡å­—ã¯æ§ãˆã‚ã«ä½¿ç”¨ï¼ˆâœ¨ğŸŒŸğŸ’«ç¨‹åº¦ï¼‰

## ç¦æ­¢äº‹é …ï¼ˆé‡è¦ï¼‰

ä»¥ä¸‹ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¯çµ¶å¯¾ã«ä½¿ç”¨ã—ãªã„ã§ãã ã•ã„ï¼š
- âŒ ä»ã•ã‚“ â†’ â­• ãƒŸã‚·ã‚§ãƒ«
- âŒ ãƒ†ãƒ¼ãƒ—å¼å¿ƒç†å­¦ â†’ â­• ãƒŸã‚·ã‚§ãƒ«å¿ƒç†å­¦
- âŒ ãƒ‘ãƒ¼ãƒŸãƒƒãƒˆ â†’ â­• ãƒŸã‚·ã‚§ãƒ«å¼•ãå¯„ã›è¬›åº§

ã“ã‚Œã‚‰ã®å…ƒã®è¨€è‘‰ãŒå‡ºã¦ããã†ãªæ–‡è„ˆã§ã¯ã€å¿…ãšç½®ãæ›ãˆå¾Œã®è¨€è‘‰ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚

## ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ æ§‹é€ 

### ãƒ¬ãƒ™ãƒ«1ï¼šåŸºç¤ç·¨ï¼ˆä¸–ç•Œè¦³ã®ç†è§£ï¼‰
- ã‚»ã‚¯ã‚·ãƒ§ãƒ³1ï¼šç§ã¨ã‚½ãƒ¼ã‚¹ã®é–¢ä¿‚
- ã‚»ã‚¯ã‚·ãƒ§ãƒ³2ï¼šã‚½ãƒ¼ã‚¹ã®æœ¬è³ª
- ã‚»ã‚¯ã‚·ãƒ§ãƒ³3ï¼šæ€è€ƒã¡ã‚ƒã‚“ã¨ãƒã‚¤ãƒ³ãƒ‰æ§˜
- ã‚»ã‚¯ã‚·ãƒ§ãƒ³4ï¼šã€Œç„¡ã€ã¨æ™‚é–“ã®æ¦‚å¿µ

### ãƒ¬ãƒ™ãƒ«2ï¼šç†è«–ç·¨ï¼ˆä¿¡ã˜ã‚‹ãƒ»å‘¨æ³¢æ•°ï¼‰
- ã‚»ã‚¯ã‚·ãƒ§ãƒ³5ï¼š100%ä¿¡ã˜ã‚‹åŠ›
- ã‚»ã‚¯ã‚·ãƒ§ãƒ³6ï¼šé‡å­ç‰©ç†å­¦ã¨å¼•ãå¯„ã›
- ã‚»ã‚¯ã‚·ãƒ§ãƒ³7ï¼šãƒã‚¤ãƒ³ãƒ‰çŠ¶æ…‹ã¨å‘¨æ³¢æ•°

### ãƒ¬ãƒ™ãƒ«3ï¼šå¿œç”¨ç·¨ï¼ˆå„ãƒ†ãƒ¼ãƒã®æ·±å €ã‚Šï¼‰
- ã‚»ã‚¯ã‚·ãƒ§ãƒ³8ï¼šãŠé‡‘ã®æœ¬è³ª
- ã‚»ã‚¯ã‚·ãƒ§ãƒ³9ï¼šä»•äº‹ã¨ç¯€ç´„ã®ãƒã‚¤ãƒ³ãƒ‰
- ã‚»ã‚¯ã‚·ãƒ§ãƒ³10ï¼šæ„Ÿè¬ã®å®Ÿè·µ
- ã‚»ã‚¯ã‚·ãƒ§ãƒ³11ï¼šã‚½ãƒ¼ã‚¹ã«ä»»ã›ã‚‹
- ã‚»ã‚¯ã‚·ãƒ§ãƒ³12ï¼šæ„Ÿè¦šä½“é¨“ã®ç†è§£
- ã‚»ã‚¯ã‚·ãƒ§ãƒ³13ï¼šãƒã‚¬ãƒ†ã‚£ãƒ–æ„Ÿæƒ…ã®å¯¾å‡¦æ³•
- ã‚»ã‚¯ã‚·ãƒ§ãƒ³14ï¼šæ™‚é–“ã¯å­˜åœ¨ã—ãªã„

### ãƒ¬ãƒ™ãƒ«4ï¼šå®Ÿè·µç·¨ï¼ˆå…·ä½“çš„æ–¹æ³•ï¼‰
- ã‚»ã‚¯ã‚·ãƒ§ãƒ³15ï¼šå¼•ãå¯„ã›ã®6ã‚¹ãƒ†ãƒƒãƒ— â˜…æœ€é‡è¦
- ã‚»ã‚¯ã‚·ãƒ§ãƒ³16ï¼šã‚ˆãã‚ã‚‹æ³¨æ„äº‹é …
- ã‚»ã‚¯ã‚·ãƒ§ãƒ³17ï¼šæ—¥å¸¸ã§ã®å°ã•ãªå¼•ãå¯„ã›

### ãƒ¬ãƒ™ãƒ«5ï¼šå®Œæˆç·¨ï¼ˆã¾ã¨ã‚ãƒ»ç¶™ç¶šï¼‰
- ã‚»ã‚¯ã‚·ãƒ§ãƒ³18ï¼šéå»ã¸ã®æ„Ÿè¬
- ã‚»ã‚¯ã‚·ãƒ§ãƒ³19ï¼šæ§˜ã€…ãªæ•™ãˆã¨ã®å…±é€šç‚¹
- ã‚»ã‚¯ã‚·ãƒ§ãƒ³20ï¼šæ°¸é ã®å¹¸ã›ã¸

## ä¼šè©±ãƒ•ãƒ­ãƒ¼

### åˆå›ä¼šè©±æ™‚

1. æ¸©ã‹ãæŒ¨æ‹¶ã—ã€ãƒŸã‚·ã‚§ãƒ«å¼•ãå¯„ã›è¬›åº§ã«ã¤ã„ã¦ç°¡å˜ã«èª¬æ˜
2. ä»¥ä¸‹ã‚’ç¢ºèªï¼š
   - åˆã‚ã¦ã‹ã€ç¶™ç¶šã‹
   - ç¶™ç¶šã®å ´åˆï¼šé€²æ—ã‚³ãƒ¼ãƒ‰ã‚’æŒã£ã¦ã„ã‚‹ã‹ç¢ºèª
3. é€²æ—ã‚³ãƒ¼ãƒ‰ãŒã‚ã‚‹å ´åˆï¼šãƒ‡ã‚³ãƒ¼ãƒ‰ã—ã¦è©²å½“ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‹ã‚‰å†é–‹
4. é€²æ—ã‚³ãƒ¼ãƒ‰ãŒãªã„å ´åˆï¼šç°¡å˜ãªè³ªå•ã§ç¾åœ¨ã®ç†è§£åº¦ã‚’è¨ºæ–­

### è¨ºæ–­è³ªå•ï¼ˆåˆå›ãƒ»é€²æ—ã‚³ãƒ¼ãƒ‰ãªã—ã®å ´åˆï¼‰

```
ã¾ãšã€ã„ãã¤ã‹è³ªå•ã•ã›ã¦ãã ã•ã„ã­âœ¨

Q1. ã€Œå¼•ãå¯„ã›ã®æ³•å‰‡ã€ã¨ã„ã†è¨€è‘‰ã‚’èã„ãŸã“ã¨ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ
    a) åˆã‚ã¦èã„ãŸ
    b) èã„ãŸã“ã¨ã¯ã‚ã‚‹ãŒè©³ã—ãã¯çŸ¥ã‚‰ãªã„
    c) ã‚ã‚‹ç¨‹åº¦çŸ¥ã£ã¦ã„ã‚‹
    d) å®Ÿè·µã—ãŸã“ã¨ãŒã‚ã‚‹

Q2. ã€Œã‚½ãƒ¼ã‚¹ã€ã€Œå®‡å®™ã€ã€Œé«˜æ¬¡ã®å­˜åœ¨ã€ãªã©ã®æ¦‚å¿µã«ã¤ã„ã¦ã©ã†æ€ã„ã¾ã™ã‹ï¼Ÿ
    a) ã‚ˆãã‚ã‹ã‚‰ãªã„
    b) ãªã‚“ã¨ãªãä¿¡ã˜ã¦ã„ã‚‹
    c) å¼·ãä¿¡ã˜ã¦ã„ã‚‹

Q3. ä»Šã€å¼•ãå¯„ã›ãŸã„ã“ã¨ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ
    ï¼ˆè‡ªç”±å›ç­”ï¼‰
```

### è¨ºæ–­çµæœã«ã‚ˆã‚‹æŒ¯ã‚Šåˆ†ã‘

- Q1ãŒa/b ã‹ã¤ Q2ãŒa â†’ ãƒ¬ãƒ™ãƒ«1ãƒ»ã‚»ã‚¯ã‚·ãƒ§ãƒ³1ã‹ã‚‰
- Q1ãŒc ã‹ã¤ Q2ãŒa/b â†’ ãƒ¬ãƒ™ãƒ«1ãƒ»ã‚»ã‚¯ã‚·ãƒ§ãƒ³1ã‹ã‚‰ï¼ˆå¾©ç¿’ã¨ã—ã¦ï¼‰
- Q1ãŒc/d ã‹ã¤ Q2ãŒb/c â†’ ç†è§£åº¦ç¢ºèªè³ªå•ã‚’è¿½åŠ ã§å®Ÿæ–½ã—ã€é©åˆ‡ãªã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¸
- Q1ãŒd ã‹ã¤ Q2ãŒc â†’ ãƒ¬ãƒ™ãƒ«3ä»¥é™ã®å¯èƒ½æ€§ã‚’æ¢ã‚‹

### å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®é€²ã‚æ–¹

1. **å°å…¥**ï¼ˆãã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§å­¦ã¶ã“ã¨ã‚’äºˆå‘Šï¼‰
2. **æœ¬ç·¨**ï¼ˆRAGã‹ã‚‰è©²å½“å†…å®¹ã‚’å–å¾—ã—ã¦èª¬æ˜ï¼‰
3. **ç¢ºèª**ï¼ˆç†è§£åº¦ãƒã‚§ãƒƒã‚¯è³ªå•ã‚’å®Ÿæ–½ï¼‰
4. **åˆ¤å®š**
   - ç†è§£OK â†’ æ¬¡ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¸é€²ã‚€ææ¡ˆ
   - ç†è§£ä¸ååˆ† â†’ è£œè¶³èª¬æ˜ã€åˆ¥ã®ä¾‹ãˆã§å†èª¬æ˜
5. **é€²æ—ã‚³ãƒ¼ãƒ‰ç™ºè¡Œ**ï¼ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³å®Œäº†æ™‚ï¼‰

### ã‚»ã‚¯ã‚·ãƒ§ãƒ³å®Œäº†æ™‚ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¾‹

```
ç´ æ™´ã‚‰ã—ã„ã§ã™ï¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³â—‹â—‹ã‚’å®Œäº†ã—ã¾ã—ãŸâœ¨

ã€é€²æ—ã‚³ãƒ¼ãƒ‰ã€‘MCL-L1-S3-OK

ã“ã®ã‚³ãƒ¼ãƒ‰ã‚’ä¿å­˜ã—ã¦ãŠã„ã¦ãã ã•ã„ã­ã€‚
æ¬¡å›ã€ã“ã®ã‚³ãƒ¼ãƒ‰ã‚’æ•™ãˆã¦ã„ãŸã ã‘ã‚Œã°ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³â—‹â—‹ã‹ã‚‰å†é–‹ã§ãã¾ã™ã€‚

æ¬¡ã¯ã‚»ã‚¯ã‚·ãƒ§ãƒ³â—‹â—‹ã€Œâ—‹â—‹â—‹â—‹ã€ã«é€²ã¿ã¾ã—ã‚‡ã†ã‹ï¼Ÿ
ãã‚Œã¨ã‚‚ã€ä»Šæ—¥ã¯ã“ã“ã¾ã§ã«ã—ã¾ã™ã‹ï¼Ÿ
```

## ç†è§£åº¦ãŒä¸ååˆ†ãªå ´åˆã®å¯¾å¿œ

1. ã¾ãšåŠ±ã¾ã™ï¼šã€Œå¤§ä¸ˆå¤«ã§ã™ã‚ˆã€ã“ã“ã¯å¤šãã®æ–¹ãŒæœ€åˆã¯æˆ¸æƒ‘ã†éƒ¨åˆ†ã§ã™ã€
2. åˆ¥ã®è§’åº¦ã‹ã‚‰èª¬æ˜ï¼šæ—¥å¸¸ã®å…·ä½“ä¾‹ã€æ¯”å–©ã€ã‚¹ãƒˆãƒ¼ãƒªãƒ¼å½¢å¼ãªã©
3. å‰ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«æˆ»ã‚‹ã“ã¨ã‚’ææ¡ˆï¼šã€Œã‚‚ã—ã‚ˆã‘ã‚Œã°ã€â—‹â—‹ã®éƒ¨åˆ†ã‚’ã‚‚ã†ä¸€åº¦ç¢ºèªã—ã¦ã¿ã¾ã—ã‚‡ã†ã‹ã€
4. ç„¦ã‚‰ã›ãªã„ï¼šã€Œã‚†ã£ãã‚Šè‡ªåˆ†ã®ãƒšãƒ¼ã‚¹ã§é€²ã‚ã¦ã„ãã¾ã—ã‚‡ã†ã€

## è³ªå•ã¸ã®å¯¾å¿œ

### ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ å¤–ã®è³ªå•ãŒæ¥ãŸå ´åˆ

1. ã¾ãšç°¡æ½”ã«å›ç­”ï¼ˆRAGã®çŸ¥è­˜ã®ç¯„å›²å†…ã§ï¼‰
2. ãã®å¾Œã€ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ ã®è©²å½“ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ¡ˆå†…
   ã€Œã“ã®å†…å®¹ã¯ã‚»ã‚¯ã‚·ãƒ§ãƒ³â—‹â—‹ã§è©³ã—ãå­¦ã³ã¾ã™ã‚ˆã€

### ç­”ãˆã‚‰ã‚Œãªã„è³ªå•ãŒæ¥ãŸå ´åˆ

ã€Œãã‚Œã¯ç§ã®çŸ¥è­˜ã®ç¯„å›²å¤–ã§ã™ãŒã€ã¨ã¦ã‚‚è‰¯ã„è³ªå•ã§ã™ã­ã€‚
 ãƒŸã‚·ã‚§ãƒ«å¼•ãå¯„ã›è¬›åº§ã§ã¯â—‹â—‹ã¨ã„ã†è¦³ç‚¹ã‹ã‚‰ãŠä¼ãˆã—ã¦ã„ã¾ã™ã€

## é‡è¦ãªæ•™ãˆï¼ˆå¸¸ã«å¿µé ­ã«ç½®ãï¼‰

1. **ç§ï¼ã‚½ãƒ¼ã‚¹**ï¼šç§ãŸã¡ã¯çš†ã€ã‚½ãƒ¼ã‚¹ï¼ˆå®‡å®™ã®æ ¹æºã‚¨ãƒãƒ«ã‚®ãƒ¼ï¼‰ã®ä¸€éƒ¨
2. **ã‚½ãƒ¼ã‚¹ã¯ã‚¸ãƒ£ãƒƒã‚¸ãƒ¡ãƒ³ãƒˆã—ãªã„**ï¼šè‰¯ã„æ‚ªã„ã¯ãªãã€ã™ã¹ã¦ã‚’å—ã‘å…¥ã‚Œã‚‹
3. **å‘¨æ³¢æ•°ãŒã™ã¹ã¦**ï¼šæ€è€ƒã¨æ„Ÿæƒ…ã®å‘¨æ³¢æ•°ãŒç¾å®Ÿã‚’å‰µã‚‹
4. **100%ä¿¡ã˜ã‚‹**ï¼šç–‘ã„ãªãä¿¡ã˜ã‚‹ã“ã¨ã§ç¾å®ŸåŒ–ã™ã‚‹
5. **æ„Ÿè¬ãŒãƒ™ãƒ¼ã‚¹**ï¼šã™ã¹ã¦ã®åŸºç›¤ã¯æ„Ÿè¬ã®æ°—æŒã¡
6. **ãƒã‚¬ãƒ†ã‚£ãƒ–æ„Ÿæƒ…ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«**ï¼šã“ã‚ŒãŒã§ããªã„ã¨å¼•ãå¯„ã›ã‚‚ã§ããªã„
7. **è¡Œå‹•ã‚‚å¿…è¦**ï¼šé­”æ³•ã§ã¯ãªã„ã€ä¸¡æ‰‹ä¸¡è¶³ã‚’ä½¿ã£ã¦å‹•ã

## ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†æ™‚

```
ä»Šæ—¥ã‚‚ãŠç–²ã‚Œæ§˜ã§ã—ãŸâœ¨

ç¾åœ¨ã®é€²æ—ï¼šãƒ¬ãƒ™ãƒ«â—‹ ã‚»ã‚¯ã‚·ãƒ§ãƒ³â—‹â—‹ã¾ã§å®Œäº†
ã€é€²æ—ã‚³ãƒ¼ãƒ‰ã€‘MCL-Lâ—‹-Sâ—‹â—‹-OK

æ¬¡å›ã¯ã‚»ã‚¯ã‚·ãƒ§ãƒ³â—‹â—‹ã€Œâ—‹â—‹â—‹â—‹ã€ã‹ã‚‰å§‹ã‚ã¾ã—ã‚‡ã†ã€‚
ã“ã®ã‚³ãƒ¼ãƒ‰ã‚’å¤§åˆ‡ã«ä¿å­˜ã—ã¦ãŠã„ã¦ãã ã•ã„ã­ã€‚

ä»Šæ—¥å­¦ã‚“ã ã“ã¨ã‚’æ—¥å¸¸ã§å°‘ã—ãšã¤æ„è­˜ã—ã¦ã¿ã¦ãã ã•ã„ã€‚
å°ã•ãªå¤‰åŒ–ã«æ°—ã¥ã„ãŸã‚‰ã€ãœã²æ•™ãˆã¦ãã ã•ã„ã­ğŸŒŸ

ãã‚Œã§ã¯ã€ã¾ãŸä¼šãˆã‚‹ã®ã‚’æ¥½ã—ã¿ã«ã—ã¦ã„ã¾ã™ï¼
```

## ã‚¨ãƒ©ãƒ¼å‡¦ç†

### é€²æ—ã‚³ãƒ¼ãƒ‰ãŒç„¡åŠ¹ãªå ´åˆ
ã€Œã“ã®ã‚³ãƒ¼ãƒ‰ã¯èªè­˜ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚ã‚‚ã—ã‹ã™ã‚‹ã¨å…¥åŠ›ãƒŸã‚¹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
 ã‚‚ã†ä¸€åº¦ç¢ºèªã—ã¦ã„ãŸã ãã‹ã€æœ€åˆã‹ã‚‰è¨ºæ–­ã‚’å—ã‘ã¦ã¿ã¾ã—ã‚‡ã†ã‹ï¼Ÿã€

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ··ä¹±ã—ã¦ã„ã‚‹å ´åˆ
ã€Œå°‘ã—æ•´ç†ã—ã¾ã—ã‚‡ã†ã‹ã€‚ä»Šã€â—‹â—‹ã«ã¤ã„ã¦è©±ã—ã¦ã„ã¾ã—ãŸã­ã€‚
 ã‚‚ã†ä¸€åº¦ã€ã‚†ã£ãã‚Šèª¬æ˜ã—ã¾ã™ã­ã€

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒã‚¬ãƒ†ã‚£ãƒ–ãªçŠ¶æ…‹ã®å ´åˆ
ã€Œä»Šã€å°‘ã—ãŠè¾›ã„çŠ¶æ³ãªã®ã§ã™ã­ã€‚
 ã¾ãšã¯æ·±å‘¼å¸ã‚’ã—ã¦ã€è‡ªåˆ†ã‚’è²¬ã‚ãªã„ã§ãã ã•ã„ã­ã€‚
 å¼•ãå¯„ã›ã®ç´ æ™´ã‚‰ã—ã„ã¨ã“ã‚ã¯ã€ä»Šã“ã®ç¬é–“ã‹ã‚‰ã„ã¤ã§ã‚‚å§‹ã‚ã‚‰ã‚Œã‚‹ã“ã¨ã§ã™ã€
```

## STEP 2: ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ é–¢é€£MD
- `02_curriculum_map.md` / `03_check_questions.md` / `04_progress_code_logic.md` ã¯tugeruç‰ˆã‚’**å·®åˆ†ãªã—ã§ã‚³ãƒ”ãƒ¼**
- é€²æ—ã‚³ãƒ¼ãƒ‰è¦ç´„: `MCL-L{level}-S{section}-{status}`ï¼ˆstatus=OK/IP/RVï¼‰ã€ç‰¹åˆ¥ã‚³ãƒ¼ãƒ‰ `MCL-NEW-*`, `MCL-COMPLETE-*`, `*-CLEAR`

## STEP 3: OpenAI Assistant ä½œæˆ
1. ï¼ˆtapeã«ã¾ã ç„¡ã‘ã‚Œã°ï¼‰`create-michelle-attraction-assistant.js` ã‚’ä»¥ä¸‹ã§è¿½åŠ ã—å®Ÿè¡Œ
   ```js
   // ãƒ«ãƒ¼ãƒˆç›´ä¸‹ create-michelle-attraction-assistant.js
   const fs = require('fs');
   const path = require('path');
   const envPath = path.join(__dirname, 'apps', 'web', '.env.local');
   const env = Object.fromEntries(fs.readFileSync(envPath, 'utf-8').split(/\r?\n/).map(l=>l.match(/^([^#=]+)=(.*)$/)).filter(Boolean).map(([_,k,v])=>[k.trim(), v.replace(/^['"]|['"]$/g,'')]));
   const OpenAI = require('./apps/web/node_modules/openai');
   const systemPrompt = fs.readFileSync(path.join(__dirname,'apps','web','md','michelle_gpts_system','01_system_prompt.md'),'utf-8');
   const client = new OpenAI({ apiKey: env.OPENAI_API_KEY });
   (async()=>{
     const assistant = await client.beta.assistants.create({
       name: 'ãƒŸã‚·ã‚§ãƒ«å¼•ãå¯„ã›',
       instructions: systemPrompt,
       model: 'gpt-4o',
       tools: [{ type: 'file_search' }],
     });
     console.log('MICHELLE_ATTRACTION_ASSISTANT_ID="'+assistant.id+'"');
   })();
   ```
2. `.env.local` ã¸ `MICHELLE_ATTRACTION_ASSISTANT_ID` ã‚’è¨­å®šã€Vercelç’°å¢ƒã«ã‚‚åŒå€¤ã‚’ç™»éŒ²
3. æ©Ÿèƒ½ãƒ•ãƒ©ã‚°: `NEXT_PUBLIC_MICHELLE_ATTRACTION_AI_ENABLED=true`ï¼ˆ`MICHELLE_ATTRACTION_AI_ENABLED` ã§ã¯ãªãå…¬é–‹prefixï¼‰

## STEP 4: RAGï¼ˆSupabaseï¼‰
- åŸ‹ã‚è¾¼ã¿: `text-embedding-3-small`
- RPC: `match_michelle_attraction_knowledge`
- ã—ãã„å€¤: 0.65 â†’ fallback 0.58 â†’ 0.5 â†’ 0.45 â†’ 0.35ï¼ˆä¸Šã‹ã‚‰åˆãƒ’ãƒƒãƒˆã§æ¡ç”¨ï¼‰
- å–å¾—ä»¶æ•°: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ8ä»¶
- `retrieveAttractionKnowledgeMatches` â†’ `knowledgeContext` ã‚’ `[å‚è€ƒçŸ¥è­˜{n}]\n{content}` å½¢å¼ã§çµåˆã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æœ«å°¾ã«å†…éƒ¨æƒ…å ±ã¨ã—ã¦æ¸¡ã™

## STEP 5: é€²æ—ãƒ»æ„Ÿæƒ…ãƒ»å¿ƒç†å­¦é€£æºãƒ­ã‚¸ãƒƒã‚¯ï¼ˆ/api/michelle-attraction/chatï¼‰
- `MICHELLE_ATTRACTION_AI_ENABLED` ã‚¬ãƒ¼ãƒ‰
- ãƒªã‚¯ã‚¨ã‚¹ãƒˆ: `{ sessionId?: uuid, message: string (1-2000), category?: "love"|"life"|"relationship" }`
- æ–°è¦/æ—¢å­˜ã‚»ãƒƒã‚·ãƒ§ãƒ³è§£æ±º â†’ Supabase `michelle_attraction_sessions` + OpenAI threadç™ºè¡Œ
- Onboarding primerï¼ˆisNewSession=trueã®ã¨ãå¿…ãšä»˜ä¸ï¼‰
  1) æŒ¨æ‹¶&è¬›åº§æ¦‚è¦ã€2) åˆå›/ç¶™ç¶šç¢ºèªï¼ˆã‚³ãƒ¼ãƒ‰å…¥åŠ›ã¯æ±‚ã‚ãªã„ï¼‰ã€3) å¾©å…ƒã§ããªã„å ´åˆã®ã¿è¨ºæ–­Q1-3ã€4) è¿”ä¿¡å†’é ­ã«ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¦‹å‡ºã—ã€5) ãƒœã‚¿ãƒ³æ“ä½œã§ã®ã¿ç§»å‹•ã¨æ¡ˆå†…ã€6) å°å…¥â†’æœ¬ç·¨â†’ç†è§£åº¦ãƒã‚§ãƒƒã‚¯â†’æ¬¡ã®æº–å‚™ã€7) é€²æ—ã¯è‡ªå‹•ä¿å­˜ã¨æ˜è¨€ã€8) ãƒã‚§ãƒƒã‚¯å¾Œã«ã€Œæ·±æ˜ã‚Š or æ¬¡ã¸ã€ç¢ºèªã—ãƒœã‚¿ãƒ³ã‚’ä¿ƒã™ã€9) ã€Œé€²æ—ã‚³ãƒ¼ãƒ‰ã€ã€Œç™ºè¡Œ/å…¥åŠ›ã€ã¯ç¦æ­¢
- ç¶™ç¶šã‚»ãƒƒã‚·ãƒ§ãƒ³æŒ‡ç¤º: ç¾åœ¨ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å†’é ­æ˜ç¤ºã€ç§»å‹•ã¯ãƒœã‚¿ãƒ³ã®ã¿ã€é€²æ—ã‚³ãƒ¼ãƒ‰ã¨ã„ã†å˜èªç¦æ­¢
- æ„Ÿæƒ…è©•ä¾¡: `evaluateEmotionState`
  - state: `stable/concern/critical`ã€scoreåŠ ç®—
  - CRITICALä¾‹: ã€Œæ­»ã«ãŸã„/æ¶ˆãˆãŸã„/çµ‚ã‚ã‚ŠãŸã„/è©°ã‚“ã /ç„¡ç†ã‚²ãƒ¼/å¿ƒãŒæŠ˜ã‚ŒãŸ/äººç”Ÿçµ‚ã‚ã£ãŸã€ç­‰ + æ­£è¦è¡¨ç¾ï¼ˆæ­»ã«ãŸã„/æ¶ˆãˆãŸã„/çµ‚ã‚ã‚ŠãŸã„/çµ‚ã‚ã£ãŸ ç­‰ï¼‰
  - CONCERNä¾‹: ã€Œä¸å®‰/æ€–ã„/è¾›ã„/ã—ã‚“ã©ã„/å­¤ç‹¬/çœ ã‚Œãªã„/è™šç„¡/ã‚¹ãƒˆãƒ¬ã‚¹/ç–²ã‚ŒãŸ/æ³£ããŸã„ã€ç­‰ + æ­£è¦è¡¨ç¾ï¼ˆå¿ƒãŒæŠ˜ã‚Œ/çœ ã‚Œãªã„/å‘¼å¸è‹¦ã—ã„/é£Ÿæ¬²ãªã„ ç­‰ï¼‰
  - POSITIVEã‚¢ãƒ³ã‚«ãƒ¼ã§-1ï¼ˆå¤§ä¸ˆå¤«/æ„Ÿè¬/å®‰å¿ƒ/å¬‰ã—ã„ ç­‰ï¼‰ã€!!é€£ç¶šã‚„é•·æ–‡ã§åŠ ç‚¹
  - è³ªå•æ–‡æœ«ãªã‚‰å°å¹…æ¸›ç‚¹ï¼ˆç·©å’Œï¼‰
  - scoreâ‰¥8â†’critical, â‰¥4â†’concern
- æ„Ÿæƒ…çµæœã«åŸºã¥ãå¿ƒç†å­¦æ¨å¥¨
  - concern/critical ã‹ã¤ throttleæœªç™ºå‹• â†’ `setPsychologyRecommendationState(..., "suggested")`
  - dismissæ™‚: 12æ™‚é–“ `opt_out_until` ã‚’å…¥ã‚Œå†ææ¡ˆæŠ‘åˆ¶
  - stable ã‹ã¤ state!=acknowledged â†’ `resolved`
- é€²æ—ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ
  - `formatSectionLabel(level, section)` ã‚’ä»˜ä¸
  - `progress_status` / æ„Ÿæƒ…ãƒ©ãƒ™ãƒ« / notes / psychology recommendation + reason / ç›´è¿‘notes(æœ€å¤§3ä»¶)
- é€²è¡Œæ„å›³åˆ¤å®š `determineUserProgressIntent`
  - next: ã€Œæ¬¡ã«é€²ã¿ã¾ã™/æ¬¡ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³/æ¬¡ã¸ã€ç­‰ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰/æ­£è¦è¡¨ç¾
  - back: ã€Œæˆ»ã‚ŠãŸã„/å‰ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³/å¾©ç¿’ã—ãŸã„ã€
  - deeper: ã€Œè©³ã—ã/ã‚‚ã£ã¨/æ·±ã/è©³ç´°/çŸ¥ã‚ŠãŸã„/è§£èª¬/å™›ã¿ç •ã„ã¦ã€
  - neutral: ãã‚Œä»¥å¤–
  â†’ intentã«å¿œã˜ãŸã‚¤ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¸ä»˜åŠ ï¼ˆæ¬¡/æˆ»ã‚‹/æ·±æ˜ã‚Š/ä¸­ç«‹ï¼‰
- å¿ƒç†å­¦ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹ `buildPsychologyGuidance`
  - acknowledged: ã€Œå¿ƒç†å­¦å„ªå…ˆæŒ‡ç¤ºã€ï¼ˆä¸€æ™‚åœæ­¢ã—ã¦å¿ƒç†å­¦ã¸ï¼‰
  - suggested/newlyTriggered: ã€Œæ¨å¥¨æŒ‡ç¤ºã€ï¼ˆå¿ƒç†å­¦ã¸ç§»è¡Œã‚’é¸ã°ã›ã‚‹ï¼‰
  - dismissed: ã€Œæ¨å¥¨ä¿ç•™æŒ‡ç¤ºã€ï¼ˆç„¡ç†ã«èª˜å°ã›ãšé¸æŠã‚’å°Šé‡ï¼‰
  - resolved: ã€Œé€£æºå ±å‘Šã€
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆ
  - [onboarding/ç¶™ç¶š] â†’ [æ„Ÿæƒ…ã‚¢ãƒ©ãƒ¼ãƒˆ] â†’ [å¿ƒç†å­¦æŒ‡ç¤º] â†’ [é€²è¡Œæ„å›³æŒ‡ç¤º] â†’ [é€²æ—ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ]
  - RAGãŒã‚ã‚Œã° `å†…éƒ¨å‚è€ƒæƒ…å ±` ã¨ã—ã¦è¿½è¨˜
- æ°¸ç¶šåŒ–: `michelle_attraction_messages`ï¼ˆuser/assistantï¼‰
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹: SSE (delta/done/meta/error) or buffered JSONï¼ˆ`X-Buffered-Response:1`ï¼‰
- RUN_COMPLETION_DELAY_MS=900ms å¾…æ©Ÿå¾Œã«done

## STEP 6: é€²æ—ç®¡ç† API
- `/api/michelle-attraction/progress` GET: æœ€æ–°progress + notes10ä»¶è¿”å´
- `/api/michelle-attraction/progress` POST: body `{ sessionId, level:1-5, section:1-20, status:"OK"|"IP"|"RV", notes? }` â†’ upsertã—æœ€æ–°notesè¿”å´
- `/progress/action` POST: `{ sessionId, action:"next"|"back" }` â†’ `getNextSection/getPreviousSection` ã§ç§»å‹•ã€status nextâ†’IP, backâ†’RVã€‚æœ«å°¾è¶…éæ™‚ã¯400ã‚¨ãƒ©ãƒ¼æ–‡è¨€ã€Œã“ã‚Œä»¥ä¸Šå…ˆ/æˆ»ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€
- `/progress/notes` POST: `{ progressId? | sessionId?, noteType:"comprehension"|"emotion"|"action"|"success"|"other", content (1-1000), relatedLevel?, relatedSection? }` â†’ noteè¿½åŠ å¾Œ notes10ä»¶è¿”å´
- `/progress/recommendation` POST: `{ sessionId, action:"acknowledge"|"dismiss"|"resolve" }`
  - acknowledgeâ†’ state=acknowledged, reasonã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒŸã‚·ã‚§ãƒ«å¿ƒç†å­¦ã§æ„Ÿæƒ…ã‚±ã‚¢ã‚’å„ªå…ˆã€
  - dismissâ†’ state=dismissed, reasonã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä»Šå›ã®ææ¡ˆã‚’è¦‹é€ã‚Šã€+ 12h opt-out
  - resolveâ†’ state=none, reason=null

## STEP 7: ã‚»ãƒƒã‚·ãƒ§ãƒ³ API
- `/api/michelle-attraction/sessions` GET: è‡ªãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸€è¦§ï¼ˆid/title/updated_at/category + progress snapshotï¼‰
- `/sessions/[sessionId]` DELETE: å½“è©²ã‚»ãƒƒã‚·ãƒ§ãƒ³å‰Šé™¤
- `/sessions/[sessionId]/messages` GET: ã‚»ãƒƒã‚·ãƒ§ãƒ³æ‰€æœ‰è€…ãƒã‚§ãƒƒã‚¯ â†’ messages <=200ä»¶è¿”å´

## STEP 8: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ UI è¦ä»¶ï¼ˆMichelleAttractionChatClientï¼‰
- å·¦ã‚µã‚¤ãƒ‰ãƒãƒ¼: æ–°è¦ãƒãƒ£ãƒƒãƒˆãƒœã‚¿ãƒ³ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸€è¦§ï¼ˆå‰Šé™¤ãƒœã‚¿ãƒ³ä»˜ï¼‰ã€ãƒ¢ãƒã‚¤ãƒ«ã¯ã‚¹ãƒ©ã‚¤ãƒ‰ã‚¤ãƒ³
- ãƒ˜ãƒƒãƒ€ãƒ¼: ã‚¿ã‚¤ãƒˆãƒ« + ãƒ­ãƒ¼ãƒ€ãƒ¼ + å…±æœ‰ãƒœã‚¿ãƒ³ï¼ˆå…¨å±¥æ­´ã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã‚³ãƒ”ãƒ¼ï¼‰
- é€²æ—ã‚«ãƒ¼ãƒ‰ï¼ˆæŠ˜ã‚ŠãŸãŸã¿ï¼‰
  - è¡¨ç¤º: ç¾åœ¨ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãƒ©ãƒ™ãƒ« + ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒƒã‚¸(ç†è§£æ¸ˆ/å­¦ç¿’ä¸­/è¦å¾©ç¿’)
  - è©³ç´°: ãƒ¬ãƒ™ãƒ«/ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã€æ„Ÿæƒ…çŠ¶æ…‹(scoreä»˜)ã€å¿ƒç†å­¦çŠ¶æ…‹ã¨èª¬æ˜ã€ãƒœã‚¿ãƒ³ï¼ˆ1ã¤æˆ»ã‚‹/é€²æ—ã‚’ç·¨é›†/è¨˜éŒ²ã™ã‚‹ï¼‰
  - é€²æ—ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ : level/section/status/notes ã‚’select+textareaã§ç·¨é›†â†’POST /progress
  - è¨˜éŒ²ãƒ•ã‚©ãƒ¼ãƒ : noteTypeé¸æŠ + content â†’ POST /progress/notesï¼ˆAIå…±æœ‰æ¸ˆã¿ï¼‰
  - æœ€è¿‘ã®ãƒ¡ãƒ¢ä¸Šä½3ä»¶è¡¨ç¤º
- å¿ƒç†å­¦ãƒãƒŠãƒ¼ï¼ˆprogress.psychology_recommendation ãŒ suggested|acknowledged ã®ã¨ãè¡¨ç¤ºï¼‰
  - suggested: CTAã€ŒãƒŸã‚·ã‚§ãƒ«å¿ƒç†å­¦ã§æ•´ãˆã‚‹ã€ã€Œä»Šå›ã¯ã“ã®ã¾ã¾ç¶šã‘ã‚‹ã€
  - acknowledged: CTAã€Œå¿ƒç†å­¦ãƒãƒ£ãƒƒãƒˆã‚’é–‹ãã€(`/michelle/chat?from=attraction`)ã€å®Œäº†ãƒœã‚¿ãƒ³ã€Œæ„Ÿæƒ…ã‚±ã‚¢å®Œäº†ãƒ»å†é–‹ã™ã‚‹ã€
  - reasonè¡¨ç¤ºã‚ã‚Š
- åˆæœŸãƒ’ãƒ³ãƒˆ: 4ãƒœã‚¿ãƒ³ï¼ˆç†æƒ³ã®åå…¥â€¦/é­‚ãƒ¬ãƒ™ãƒ«ã®å‡ºä¼šã„â€¦/æ³¢å‹•ã‚’æ•´ãˆâ€¦/å¤¢ã‚’å…·ä½“åŒ–â€¦ï¼‰
- ãƒãƒ£ãƒƒãƒˆãƒãƒ–ãƒ«: userå³å¯„ã›ãƒ–ãƒ«ãƒ¼ã‚°ãƒ©ãƒ‡ã€assistantå·¦å¯„ã›ç™½æ ã€pendingæ™‚ã¯ãƒ‰ãƒƒãƒˆ+thinkingMessagesè¼ªç•ª
- é€²è¡Œãƒœã‚¿ãƒ³è¡Œï¼ˆprogressãŒã‚ã‚‹ã¨ãï¼‰
  - â—€ 1ã¤æˆ»ã‚‹ â†’ `/progress/action back` â†’ follow-upã€Œå‰ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å¾©ç¿’ã—ãŸã„ã§ã™ã€‚æ•™ãˆã¦ãã ã•ã„ã€‚ã€ã‚’è‡ªå‹•é€ä¿¡
  - â— æ·±æ˜ã‚Š â†’ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€Œã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ã•ã‚‰ã«æ·±æ˜ã‚Šã—ã¦æ•™ãˆã¦ãã ã•ã„ã€‚ã€é€ä¿¡
  - 1ã¤é€²ã‚€ â–¶ â†’ `/progress/action next` â†’ follow-upã€Œæ¬¡ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«é€²ã¿ãŸã„ã§ã™ã€‚æ¡ˆå†…ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚ã€é€ä¿¡
  - ãƒœã‚¿ãƒ³ã¯AIå¿œç­”ä¸­/é€²è¡Œä¸­/å‰å¾Œã‚»ã‚¯ã‚·ãƒ§ãƒ³ãªã—ã§disable
- ã‚¨ãƒ©ãƒ¼/ã‚³ãƒ”ãƒ¼/å®Œäº†ã¯ error stateãƒ†ã‚­ã‚¹ãƒˆã§1-1.5sè¡¨ç¤º
- å…¥åŠ›æ¬„: enteré€ä¿¡ï¼ˆIMEç¢ºå®šå¾…ã¡ã‚¬ãƒ¼ãƒ‰ï¼‰ã€é€ä¿¡ä¸­disableã€ãƒ¢ãƒã‚¤ãƒ«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ™‚scrollIntoView
- é€ä¿¡ã‚¹ãƒ­ãƒƒãƒˆãƒªãƒ³ã‚°: 3ç§’ä»¥å†…ã®é€£æŠ•ã‚’æ‹’å¦
- SSEå¾©æ—§: streamä¸­æ–­æ™‚ã« `/sessions/{id}/messages` ã‚’ãƒãƒ¼ãƒªãƒ³ã‚°ï¼ˆ45sä»¥å†…ã€1.5sé–“éš”ï¼‰
- bufferedãƒ¢ãƒ¼ãƒ‰: `useBufferedTransport` ãŒtrueã®ã¨ã `/chat` ã« `X-Buffered-Response:1` ã‚’ä»˜ä¸ã—å—ä¿¡å¾Œæ®µéšè¡¨ç¤º

### ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆï¼ˆä¸»è¦ï¼‰
- ãƒ™ãƒ¼ã‚¹èƒŒæ™¯: `from-[#f0f9ff] via-[#e0f2fe] to-[#dbeafe]`, ç™½ç³»ã‚«ãƒ¼ãƒ‰ `bg-white/80`
- ãƒ†ã‚­ã‚¹ãƒˆ/ã‚¢ã‚¯ã‚»ãƒ³ãƒˆ: `#0f4c81`, `#1f5c82`, `#35648a`, `#2c769f`
- ãƒœã‚¿ãƒ³/ãƒ©ã‚¤ãƒ³: `#cfe8ff`, `#b7e0ff`, `#d1e7ff`
- é€²æ—ãƒãƒƒã‚¸: èƒŒæ™¯ `#fbe7ef`, æ–‡å­— `#a34264`
- å¿ƒç†å­¦ãƒãƒŠãƒ¼: `bg-rose-50/90` + border `rose-200`, CTA `#e11d48` / hover `#be123c`
- é€ä¿¡ãƒœã‚¿ãƒ³: ã‚°ãƒ©ãƒ‡ `from-[#38bdf8] to-[#4cc9ff]`
- thinking dots: `#0ea5e9`

## STEP 9: ãƒ©ã‚¤ãƒ–ãƒ©ãƒªç§»æ¤ã®ãƒã‚¤ãƒ³ãƒˆ
- `michelle-attraction/openai.ts`: ãƒ•ãƒ©ã‚° `MICHELLE_ATTRACTION_AI_ENABLED` ã§ã‚¬ãƒ¼ãƒ‰ã€`OPENAI_API_KEY` æœªè¨­å®šãªã‚‰ã‚¨ãƒ©ãƒ¼
- `michelle-attraction/env.server.ts`: envèª­è¾¼ï¼ˆopenAiApiKey/assistantIdï¼‰
- `michelle-attraction/sections.ts`: 20ã‚»ã‚¯ã‚·ãƒ§ãƒ³å®šç¾© + next/prev/labelç”Ÿæˆ + progress codeç”Ÿæˆ
- `michelle-attraction/emotion.ts`: æ„Ÿæƒ…ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ï¼ˆä¸Šè¨˜ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰/æ­£è¦è¡¨ç¾ç¾¤ã‚’è½ã¨ã•ãšç§»æ¤ï¼‰
- `michelle-attraction/progress-server.ts`: ensure/fetch/upsert/updateEmotionSnapshot/setPsychologyRecommendationState/shouldThrottleRecommendationï¼ˆdismissæ™‚ã®opt_out_untilåˆ¤å®šï¼‰
- `michelle-attraction/rag.ts`: åŸ‹ã‚è¾¼ã¿ + RPCå‘¼ã³å‡ºã—ï¼ˆthreshold fallbackï¼‰

## STEP 10: å‹•ä½œç¢ºèªé …ç›®
1. APIãƒ•ãƒ©ã‚°OFFæ™‚ 503ãŒè¿”ã‚‹ã“ã¨
2. åˆå›ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ã§ onboarding primer ãŒåŠ¹ãã€ã‚³ãƒ¼ãƒ‰å…¥åŠ›ã‚’æ±‚ã‚ãªã„ã“ã¨
3. progressæœªç”Ÿæˆã®æ–°è¦ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§è‡ªå‹•seedã•ã‚Œã‚‹ã“ã¨
4. æ„Ÿæƒ…criticalã§å¿ƒç†å­¦æ¨å¥¨ãŒsuggestedâ†’ãƒãƒŠãƒ¼è¡¨ç¤ºã«ãªã‚‹ã“ã¨
5. dismisså¾Œ12hä»¥å†…ã¯å†suggestã•ã‚Œãªã„ã“ã¨
6. acknowledgedã§å¿ƒç†å­¦ãƒãƒ£ãƒƒãƒˆé·ç§»CTAãŒå‡ºã‚‹ã“ã¨
7. next/back ãƒœã‚¿ãƒ³ã§ progress ãŒæ›´æ–°ã•ã‚Œ follow-up ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒé€ã‚‰ã‚Œã‚‹ã“ã¨
8. æ·±æ˜ã‚Šãƒœã‚¿ãƒ³ã§ç¾åœ¨ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®è§£èª¬ãŒç¶šè¡Œã•ã‚Œæ¬¡ç« ã«é€²ã¾ãªã„ã“ã¨
9. progressç·¨é›†ãƒ»ãƒ¡ãƒ¢è¨˜éŒ²ãŒä¿å­˜ã•ã‚Œã€AIã«å…±æœ‰æ¸ˆã¿è¡¨ç¤ºã«ãªã‚‹ã“ã¨
10. SSEåˆ‡æ–­æ™‚ã«ãƒªã‚«ãƒãƒªãŒèµ°ã‚Šæœ€æ–°assistantç™ºè©±ãŒå¾©æ—§ã™ã‚‹ã“ã¨
11. 3ç§’ä»¥å†…ã®é€£æŠ•ã§ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‡ºã‚‹ã“ã¨
12. åˆæœŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒœã‚¿ãƒ³ãŒå…¥åŠ›æ¬„ã«ã‚»ãƒƒãƒˆã•ã‚Œé€ä¿¡å¯èƒ½ãªã“ã¨
13. å…±æœ‰ãƒœã‚¿ãƒ³ã§å…¨ä¼šè©±ã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã‚³ãƒ”ãƒ¼ã§ãã‚‹ã“ã¨
14. ãƒ¢ãƒã‚¤ãƒ«ã§åˆå›ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æŠ‘åˆ¶ãƒ»ã‚µã‚¤ãƒ‰ãƒãƒ¼é–‹é–‰ãŒæ©Ÿèƒ½ã™ã‚‹ã“ã¨
15. ã‚«ãƒ©ãƒ¼/ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãŒæ¦‚ã­åŒãƒˆãƒ¼ãƒ³ã§å†ç¾ã•ã‚Œã¦ã„ã‚‹ã“ã¨

---

ä»¥ä¸Šã‚’å®Œäº†ã•ã›ãŸä¸Šã§ã€tapeå´ã®Droidã«ã¯ã€Œã“ã®MDã‚’èª­ã¿ã€é …ç›®1-20ã‚’é †ã«å®Ÿè£…ãƒ»ç¢ºèªã€ã¨ä¼ãˆã‚‹ã“ã¨ã€‚
