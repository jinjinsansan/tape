# ミシェル心理学チャット監視システム セットアップ手順

## 概要
マスター管理者専用のミシェル心理学チャット監視システムです。
- リアルタイムでユーザーの会話履歴を閲覧
- 緊急度（通常/注意/緊急/最重要）を設定
- 危険ワード（「死にたい」など）を自動ハイライト
- パスワード保護（マスター管理者のみアクセス可能）

## セットアップ手順

### 1. データベースマイグレーション適用

Supabase ダッシュボードで以下のSQLを実行：

```bash
# ローカルの場合
cd supabase
supabase db reset

# または、マイグレーションファイルを直接実行
# 202412130001_add_michelle_urgency.sql
```

### 2. 環境変数設定（オプション）

`.env.local` に以下を追加（デフォルトでも動作します）：

```
MASTER_ADMIN_PASSWORD_HASH="$2b$10$2jTGZbIKFqg/HKcIXg6gm.Bo5tpIEcnhRWDma3oZeICeAXnMGapAi"
```

### 3. アクセス方法

1. ブラウザで `/admin/michelle-monitoring` にアクセス
2. ログイン情報を入力：
   - メールアドレス: `goldbenchan@gmail.com`
   - パスワード: `kusano`
3. ログイン成功後、監視画面が表示されます

### 4. セッションタイムアウト

- 30分間操作がない場合、自動的にログアウトされます
- 再度ログインが必要になります

## 使い方

### ユーザー一覧（左側パネル）

- **緊急度でフィルター**: 「全て」「最重要」「緊急」「注意」ボタンでフィルタリング
- **自動更新**: 30秒ごとに自動で更新
- **緊急度の色分け**:
  - 🟢 通常（グレー）
  - 🟡 注意（イエロー）
  - 🟠 緊急（オレンジ）
  - 🔴 最重要（レッド）

### 会話履歴（右側パネル）

- **自動更新**: 選択したセッションは10秒ごとに自動で更新
- **危険ワード検出**: 「死にたい」「消えたい」などのキーワードを赤色でハイライト
- **緊急度設定**: 右上のボタンで緊急度を変更可能（メモも追加可能）

### 緊急度の設定方法

1. ユーザーを選択
2. 右上の緊急度ボタン（通常/注意/緊急/最重要）をクリック
3. メモを入力（任意）
4. OKをクリック

## セキュリティ

- パスワードは bcrypt でハッシュ化されています
- セッションは HTTP-only cookie で管理
- 環境変数でパスワードハッシュを上書き可能

## パスワード変更方法

1. 新しいハッシュを生成:
```bash
node scripts/generate-master-password.js
```

2. `.env.local` を更新:
```
MASTER_ADMIN_PASSWORD_HASH="新しいハッシュ"
```

3. Vercel にデプロイする場合は、環境変数を更新

## 仲間に教える場合

パスワードは **`kusano`** です。
メールアドレスは **`goldbenchan@gmail.com`** です。

URL: `https://yourdomain.com/admin/michelle-monitoring`

## トラブルシューティング

### ログインできない
- メールアドレスとパスワードを確認
- ブラウザのキャッシュをクリア
- 環境変数が正しく設定されているか確認

### セッションが表示されない
- データベースマイグレーションが適用されているか確認
- Supabase の RLS ポリシーを確認

### 自動更新されない
- ブラウザの開発者ツールでネットワークエラーを確認
- セッションタイムアウトの可能性（再ログイン）
